<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Photo Cropper – 300x300</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#334155; --text:#e5e7eb;
      --accent:#22c55e; --accent-2:#60a5fa;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      background:linear-gradient(120deg,#0b1224,#0f172a 40%,#111827);
      color:var(--text); min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:24px;}
    .app{width:100%; max-width:1100px; display:grid; grid-template-columns:1.2fr 1fr; gap:20px}
    @media (max-width: 980px){ .app{grid-template-columns:1fr;} }
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08);
      border-radius:18px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
    h1{margin:0 0 8px; font-size: clamp(20px, 3vw, 32px)}
    .sub{color:#cbd5e1; font-size:14px; margin-bottom:18px}
    .pane{display:grid; gap:14px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    label{font-size:12px; color:#cbd5e1; margin-bottom:6px; display:block}
    input[type="number"], select{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:#0b1326; color:var(--text); outline:none;
    }
    .btn{appearance:none; border:none; background:linear-gradient(180deg,#34d399,#059669); color:#072014;
      font-weight:700; padding:12px 16px; border-radius:14px; cursor:pointer; width:100%;
      box-shadow:0 10px 20px rgba(5,150,105,.35); transition:transform .1s ease}
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:linear-gradient(180deg,#93c5fd,#3b82f6); color:#081423; box-shadow:0 10px 20px rgba(59,130,246,.35)}
    .toolbar{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .preview-box{display:grid; grid-template-rows:auto 1fr auto; gap:10px; height:100%}
    .drop{background:repeating-linear-gradient(135deg,rgba(255,255,255,.06) 0 10px, rgba(255,255,255,.03) 10px 20px);
      border:2px dashed rgba(255,255,255,.25); border-radius:16px; padding:16px; text-align:center; min-height:220px;
      display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;}
    .drop.drag{border-color:var(--accent)}
    .drop input{position:absolute; inset:0; opacity:0; cursor:pointer}
    .drop .hint{pointer-events:none}
    .meta{font-size:12px; color:#a3a3a3}
    canvas{width:100%; height:auto; background:transparent; border-radius:12px}
    .footer{opacity:.75; font-size:12px; text-align:center; margin-top:8px}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#0b1326; border:1px solid rgba(255,255,255,.12)}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Photo Cropper</h1>
      <div class="sub">Always crops center to 300×300 px and lets you set output format + KB limit (1–100 KB).</div>

      <div class="pane">
        <div class="drop" id="drop">
          <input type="file" id="file" accept="image/*" />
          <div class="hint">
            <div style="font-weight:700; font-size:18px">Drop an image here or click to upload</div>
            <div class="meta">Supported: JPG, PNG, WebP, etc.</div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="format">Output format</label>
            <select id="format">
              <option value="image/jpeg">JPEG (.jpg)</option>
              <option value="image/webp" selected>WebP (.webp)</option>
              <option value="image/png">PNG (.png)</option>
            </select>
          </div>
          <div>
            <label for="quality">Quality (1–100)</label>
            <input type="number" id="quality" value="90" min="1" max="100" />
          </div>
        </div>

        <div>
          <label for="target">Target size (KB, 1–100)</label>
          <input type="number" id="target" placeholder="e.g. 80" min="1" max="100" />
        </div>

        <div class="toolbar">
          <button class="btn" id="btnCrop">Crop & Preview</button>
          <button class="btn secondary" id="btnDownload" disabled>Download</button>
        </div>

        <div class="meta" id="notes">© 2025 Developer: MD. NAHIDUL ISLAM </div>
      </div>
    </div>

    <div class="card preview-box">
      <div>
        <strong>Preview</strong>
        <span class="badge" id="origInfo">Original: —</span>
        <span class="badge" id="outInfo">Output: —</span>
      </div>
      <div style="display:grid; gap:10px">
        <canvas id="canvas" width="300" height="300"></canvas>
      </div>
      <div class="footer">© 2025 Developer: MD. NAHIDUL ISLAM </div>
    </div>
  </div>

  <script>
    const el = id => document.getElementById(id);
    const fileInput = el('file'), drop = el('drop');
    const canvas = el('canvas'), ctx = canvas.getContext('2d');
    const formatSel = el('format'), qualityInput = el('quality'), targetInput = el('target');
    const btnCrop = el('btnCrop'), btnDownload = el('btnDownload');
    const origInfo = el('origInfo'), outInfo = el('outInfo');

    let img = null, lastBlob = null;

    // Drag & drop
    ['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.add('drag')}));
    ;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.remove('drag')}));
    drop.addEventListener('drop', e=>{ const f=e.dataTransfer.files?.[0]; if(f) loadFile(f); });
    fileInput.addEventListener('change', e=>{ const f=e.target.files?.[0]; if(f) loadFile(f); });

    function updateOrigInfo(file, w, h){ origInfo.textContent = file ? `Original: ${w}×${h}px · ${(file.size/1024).toFixed(1)} KB` : 'Original: —'; }
    function updateOutInfo(blob){
      if(!blob){ outInfo.textContent='Output: —'; btnDownload.disabled=true; return; }
      outInfo.textContent=`Output: 300×300 px · ${(blob.size/1024).toFixed(1)} KB`;
      btnDownload.disabled=false;
      btnDownload.textContent=`Download (${(blob.size/1024).toFixed(0)} KB)`;
    }

    async function loadFile(file){
      const url=URL.createObjectURL(file);
      const image=new Image();
      image.onload=()=>{ img=image; updateOrigInfo(file,image.naturalWidth,image.naturalHeight); drawPreview(); URL.revokeObjectURL(url); };
      image.src=url;
    }

    function drawPreview(){ if(!img)return; canvas.width=300; canvas.height=300; ctx.clearRect(0,0,300,300);
      const size=Math.min(img.naturalWidth,img.naturalHeight);
      const sx=(img.naturalWidth-size)/2, sy=(img.naturalHeight-size)/2;
      ctx.drawImage(img,sx,sy,size,size,0,0,300,300);
    }

    btnCrop.addEventListener('click', async()=>{
      if(!img){alert('Upload an image first.');return;}
      const format=formatSel.value;
      let quality=Math.min(1,Math.max(0.01,(parseInt(qualityInput.value,10)||90)/100));
      let blob=await canvasToBlob(canvas,format,quality);
      const targetKB=parseInt(targetInput.value,10);
      if(targetKB && targetKB>=1 && targetKB<=100 && format!=='image/png'){
        blob=await fitToTargetKB(canvas,format,targetKB,quality);
      }
      lastBlob=blob; updateOutInfo(blob);
    });

    btnDownload.addEventListener('click',()=>{
      if(!lastBlob)return;
      const ext=formatSel.value==='image/png'?'png':(formatSel.value==='image/jpeg'?'jpg':'webp');
      const url=URL.createObjectURL(lastBlob);
      const a=document.createElement('a'); a.href=url; a.download=`cropped_300x300.${ext}`; a.click();
      setTimeout(()=>URL.revokeObjectURL(url),2000);
    });

    function canvasToBlob(c,type,q){ return new Promise(r=>c.toBlob(b=>r(b),type,q)); }

    async function fitToTargetKB(c,type,targetKB,startQ){
      let lo=0.05, hi=1.0, q=startQ, best=null;
      for(let i=0;i<12;i++){
        const b=await canvasToBlob(c,type,q); const kb=b.size/1024;
        if(Math.abs(kb-targetKB)<=1) return b;
        if(kb>targetKB){ hi=q; } else { lo=q; best=b; }
        q=(lo+hi)/2;
      }
      return best||await canvasToBlob(c,type,lo);
    }
  </script>
</body>
</html>
